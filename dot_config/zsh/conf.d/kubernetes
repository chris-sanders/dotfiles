# Function to load kubeconfig files
load_kubeconfigs() {
  export KUBECONFIG=$(find ~/.config/kube/configs.d/ -type f | tr '\n' ':')
}

# Initially load configs
load_kubeconfigs

# Reload configs on demand
alias reload_kubeconfigs='load_kubeconfigs'

# Function to set kube context per shell
set_kube_context() {
  export KUBECONFIG=$(find ~/.config/kube/configs.d/ -type f | tr '\n' ':')
  kubectl config use-context "$1"
  export KUBE_CONTEXT="$1"
}

alias kctx=set_kube_context

# Powerlevel10k customization to show Kubernetes context
typeset -g POWERLEVEL9K_KUBECONTEXT_SHOW_ON_COMMAND='kubectl'
POWERLEVEL9K_KUBECONTEXT_CONTENT_EXPANSION='${KUBE_CONTEXT}'
POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(kubecontext)

# Function to toggle kubecontext display
toggle_kubecontext() {
  if [[ " ${POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS[@]} " =~ " kubecontext " ]]; then
    POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=( ${POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS[@]/kubecontext/} )
  else
    POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS+=(kubecontext)
  fi
  p10k reload
}

alias tctx=toggle_kubecontext
